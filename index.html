<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Professional Quotation Maker</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
  h1 { text-align: center; color: #333; }
  .container { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
  label { display: block; margin-top: 10px; font-weight: bold; }
  input, textarea { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ccc; border-radius: 5px; font-size: 14px; }
  textarea { resize: vertical; }
  table { width: 100%; border-collapse: collapse; margin-top: 15px; }
  table, th, td { border: 1px solid #ccc; }
  th, td { padding: 8px; text-align: center; }
  button { margin-top: 10px; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; }
  .add-btn { background: #4CAF50; color: #fff; }
  .pdf-btn { background: #2196F3; color: #fff; }
  .totals { margin-top: 15px; text-align: right; font-weight: bold; }
</style>
</head>
<body>
<h1>Professional Quotation Maker</h1>
<div class="container">
  <label>Upload Company Logo:</label>
  <input type="file" id="logoUpload" accept="image/*">

  <label>Company Name:</label>
  <input type="text" id="company" placeholder="Your Company Name">
  
  <label>Company Address:</label>
  <input type="text" id="companyAddress" placeholder="Address Line, City">

  <label>Client Name:</label>
  <input type="text" id="client" placeholder="Client Name">

  <label>Client Address:</label>
  <input type="text" id="clientAddress" placeholder="Client Address">

  <label>Tax Type:</label>
  <input type="text" id="taxType" placeholder="e.g. GST or VAT">

  <label>Tax Percentage (%):</label>
  <input type="number" id="tax" value="0" min="0" oninput="updateLiveTotal()">

  <table id="itemsTable">
    <tr>
      <th>#</th>
      <th>Item</th>
      <th>Description</th>
      <th>Qty</th>
      <th>Price (₹)</th>
      <th>Discount (₹)</th>
      <th>Total (₹)</th>
    </tr>
  </table>
  
  <button class="add-btn" onclick="addItem()">+ Add Item</button>
  <button class="pdf-btn" onclick="generatePDF()">Generate PDF</button>

  <div class="totals" id="liveTotals">
    Subtotal: ₹0.00 | Tax: ₹0.00 | Grand Total: ₹0.00
  </div>
</div>

<script>
let uploadedLogo = null;

// Logo upload and preview
document.getElementById('logoUpload').addEventListener('change', function(e){
  const reader = new FileReader();
  reader.onload = function(event){
    uploadedLogo = event.target.result;
  }
  reader.readAsDataURL(e.target.files[0]);
});

// Add new item row
function addItem(){
  let table = document.getElementById("itemsTable");
  let row = table.insertRow();
  row.insertCell(0).innerText = table.rows.length - 1;
  row.insertCell(1).innerHTML = `<input type='text' placeholder='Item Name'>`;
  row.insertCell(2).innerHTML = `<input type='text' placeholder='Description'>`;
  row.insertCell(3).innerHTML = `<input type='number' value='1' min='1' onchange='updateRow(this)'>`;
  row.insertCell(4).innerHTML = `<input type='number' value='0' min='0' onchange='updateRow(this)'>`;
  row.insertCell(5).innerHTML = `<input type='number' value='0' min='0' onchange='updateRow(this)'>`;
  row.insertCell(6).innerHTML = `<span>0</span>`;
  updateLiveTotal();
}

// Update individual row total
function updateRow(el){
  let row = el.parentNode.parentNode;
  let qty = parseFloat(row.cells[3].children[0].value) || 0;
  let price = parseFloat(row.cells[4].children[0].value) || 0;
  let discount = parseFloat(row.cells[5].children[0].value) || 0;
  let total = (qty * price) - discount;
  row.cells[6].children[0].innerText = total.toFixed(2);
  updateLiveTotal();
}

// Live total preview
function updateLiveTotal(){
  let table = document.getElementById("itemsTable");
  let subtotal = 0;
  for(let i=1;i<table.rows.length;i++){
    subtotal += parseFloat(table.rows[i].cells[6].children[0].innerText) || 0;
  }
  let taxPercent = parseFloat(document.getElementById("tax").value) || 0;
  let taxAmount = subtotal * taxPercent / 100;
  let grandTotal = subtotal + taxAmount;
  document.getElementById("liveTotals").innerText =
    `Subtotal: ₹${subtotal.toFixed(2)} | Tax: ₹${taxAmount.toFixed(2)} | Grand Total: ₹${grandTotal.toFixed(2)}`;
}

// PDF Generation with letterhead
function generatePDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF('p','mm','a4');

  let company = document.getElementById("company").value;
  let companyAddress = document.getElementById("companyAddress").value;
  let client = document.getElementById("client").value;
  let clientAddress = document.getElementById("clientAddress").value;
  let taxType = document.getElementById("taxType").value || "Tax";
  let taxPercent = parseFloat(document.getElementById("tax").value) || 0;

  const addHeader = () => {
    if(uploadedLogo) doc.addImage(uploadedLogo, "PNG", 15, 10, 40, 40);
    doc.setFontSize(18); doc.text(company, 65, 20);
    doc.setFontSize(11); 
    doc.text(companyAddress, 65, 28);
    doc.text("Phone: XXX-XXXXXXX | Email: info@company.com", 65, 35);
    doc.setLineWidth(0.8);
    doc.line(15, 50, 195, 50);
    doc.setFontSize(16);
    doc.text("QUOTATION", 150, 45);
  };

  const addFooter = (pageNum, pageCount) => {
    doc.setFontSize(10);
    doc.setTextColor(100);
    doc.text("www.companywebsite.com | © 2025 Your Company Name", 105, 290, null, null, "center");
    doc.text(`Page ${pageNum} of ${pageCount}`, 180, 290);
  };

  addHeader();
  doc.setFontSize(12);
  doc.text("To:", 20, 55);
  doc.text(client, 30, 60);
  doc.text(clientAddress, 30, 68);

  let table = document.getElementById("itemsTable");
  let rows = [];
  let subtotal = 0;
  for(let i=1;i<table.rows.length;i++){
    let rowNum = i;
    let item = table.rows[i].cells[1].children[0].value;
    let desc = table.rows[i].cells[2].children[0].value;
    let qty = table.rows[i].cells[3].children[0].value;
    let price = table.rows[i].cells[4].children[0].value;
    let discount = table.rows[i].cells[5].children[0].value;
    let total = (qty * price) - discount;
    subtotal += total;
    rows.push([rowNum, item, desc, qty, price, discount, total.toFixed(2)]);
  }

  doc.autoTable({
    head:[['#','Item','Description','Qty','Price (₹)','Discount (₹)','Total (₹)']],
    body: rows,
    startY: 75,
    styles: { fillColor: [240,240,240] },
    headStyles: { fillColor: [100,149,237], textColor: 255, fontStyle: 'bold' },
    alternateRowStyles: { fillColor: [245,245,245] },
    didDrawPage: function(data){
      addHeader();
      addFooter(doc.internal.getCurrentPageInfo().pageNumber, doc.internal.getNumberOfPages());
    }
  });

  let taxAmount = subtotal * taxPercent / 100;
  let grandTotal = subtotal + taxAmount;
  let finalY = doc.lastAutoTable.finalY + 10;

  doc.setFontSize(12);
  doc.text(`Subtotal: ₹${subtotal.toFixed(2)}`, 140, finalY);
  doc.text(`${taxType} (${taxPercent}%): ₹${taxAmount.toFixed(2)}`, 140, finalY + 7);
  doc.setFontSize(14);
  doc.text(`Grand Total: ₹${grandTotal.toFixed(2)}`, 140, finalY + 15);

  doc.setFontSize(11);
  doc.text("Terms & Conditions:", 20, finalY + 30);
  doc.text("1. Prices valid for 30 days.", 25, finalY + 40);
  doc.text("2. Payment due within 7 days of invoice.", 25, finalY + 50);
  doc.text("3. Delivery within 10 working days.", 25, finalY + 60);

  doc.save("professional_quotation.pdf");
}
</script>
</body>
</html>
