<!DOCTYPE html>
<html lang="hi" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>рд╕реНрд╡рдЪреНрдЫ рднрд╛рд░рдд рдХреНрд╡рд┐рдЬрд╝ тАУ рдЬрд╛рдЧрд░реВрдХрддрд╛ рдЪреБрдиреМрддреА</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap">
  <style>
    /* ... [рдкреБрд░рд╛рдирд╛ CSS рд╡реИрд╕рд╛ рд╣реА рд░рд╣реЗрдЧрд╛ тАФ рдпрд╣рд╛рдБ рд╕рд┐рд░реНрдлрд╝ рдирдпрд╛ рдХреЛрдб рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ] ... */
  </style>
</head>
<body>
  <!-- ... [рдкреБрд░рд╛рдирд╛ HTML рд╡реИрд╕рд╛ рд╣реА тАФ рдХреЗрд╡рд▓ рд╢реЗрдпрд░ рдлрдВрдХреНрд╢рди рдЕрдкрдбреЗрдЯреЗрдб] ... -->

  <script>
    // ... [рдкреБрд░рд╛рдирд╛ JS рд╡реИрд╕рд╛ рд╣реА тАФ рдХреЗрд╡рд▓ shareWithImage() рдЕрдкрдбреЗрдЯреЗрдб] ...

    // ЁЯЦ╝я╕П MODERN SCORE CARD WITH QR CODE
    async function shareWithImage() {
      const canvas = document.createElement('canvas');
      canvas.width = 1080;
      canvas.height = 1350; // Instagram Story / WhatsApp Status size
      const ctx = canvas.getContext('2d');

      // ЁЯФ╣ Background: Gradient (Green тЖТ Gold тЖТ Blue)
      const gradient = ctx.createLinearGradient(0, 0, 0, 1350);
      gradient.addColorStop(0, '#e8f5e9');
      gradient.addColorStop(0.4, '#fff8e1');
      gradient.addColorStop(1, '#e3f2fd');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, 1080, 1350);

      // ЁЯФ╣ Top Tricolor Stripe
      ctx.fillStyle = '#ff9933'; // Saffron
      ctx.fillRect(0, 0, 1080, 30);
      ctx.fillStyle = '#ffffff'; // White
      ctx.fillRect(0, 30, 1080, 20);
      ctx.fillStyle = '#138808'; // Green
      ctx.fillRect(0, 50, 1080, 30);

      // ЁЯФ╣ Bottom Tricolor Stripe
      ctx.fillStyle = '#138808';
      ctx.fillRect(0, 1300, 1080, 30);
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0, 1330, 1080, 20);
      ctx.fillStyle = '#ff9933';
      ctx.fillRect(0, 1350-30, 1080, 30);

      // ЁЯФ╣ Gandhi's Spectacles (Symbolic)
      ctx.font = '120px serif';
      ctx.textAlign = 'center';
      ctx.fillStyle = '#555';
      ctx.fillText('ЁЯСУ', 540, 220);

      // ЁЯФ╣ Title
      ctx.font = 'bold 72px Poppins, sans-serif';
      ctx.fillStyle = '#1b5e20';
      ctx.fillText('рд╕реНрд╡рдЪреНрдЫ рднрд╛рд░рдд', 540, 340);
      ctx.font = '56px Poppins, sans-serif';
      ctx.fillStyle = '#2e7d32';
      ctx.fillText('рдХреНрд╡рд┐рдЬрд╝ рдкрд░рд┐рдгрд╛рдо', 540, 420);

      // ЁЯФ╣ Name
      ctx.font = 'bold 64px Poppins, sans-serif';
      ctx.fillStyle = '#0d47a1';
      const displayName = userName === "рдПрдХ рдЬрд╛рдЧрд░реВрдХ рдирд╛рдЧрд░рд┐рдХ" ? "рдЬрд╛рдЧрд░реВрдХ рдирд╛рдЧрд░рд┐рдХ" : userName;
      wrapText(ctx, displayName, 540, 540, 900, 70);

      // ЁЯФ╣ Score Circle
      ctx.beginPath();
      ctx.arc(540, 720, 160, 0, 2 * Math.PI);
      ctx.fillStyle = '#f1f8e9';
      ctx.fill();
      ctx.strokeStyle = '#4caf50';
      ctx.lineWidth = 8;
      ctx.stroke();

      // Score Text
      ctx.font = 'bold 96px Poppins, sans-serif';
      ctx.fillStyle = '#2e7d32';
      ctx.fillText(`${score}`, 540, 750);
      ctx.font = '48px Poppins, sans-serif';
      ctx.fillStyle = '#555';
      ctx.fillText('/ 20', 540, 810);

      // ЁЯФ╣ Badge
      ctx.font = 'bold 56px Poppins, sans-serif';
      let badgeColor = '#4caf50', badgeText = badgeTextElem.textContent;
      if (score === 20) badgeColor = '#ffd600';
      else if (score >= 15) badgeColor = '#ff9800';
      ctx.fillStyle = badgeColor;
      ctx.fillText(badgeText, 540, 930);

      // ЁЯФ╣ QR Code Placeholder (We'll draw a simple one)
      drawQRCode(ctx, 540 - 150, 1000, 300, getQuizUrl());

      // ЁЯФ╣ QR Label
      ctx.font = 'bold 40px Poppins, sans-serif';
      ctx.fillStyle = '#1976d2';
      ctx.fillText('рджреЛрд╕реНрдд рдХреЛ рдЪреБрдиреМрддреА рднреЗрдЬреЗрдВ!', 540, 1000 + 300 + 60);

      // ЁЯФ╣ Footer
      ctx.font = '48px Poppins, sans-serif';
      ctx.fillStyle = '#1b5e20';
      ctx.fillText('ЁЯЪ╜ рд╕реНрд╡рдЪреНрдЫрддрд╛ рд╣рдорд╛рд░рд╛ рдХрд░реНрддрд╡реНрдп ЁЯМ▒', 540, 1250);

      // ЁЯФ╣ Small Credit
      ctx.font = '28px Poppins, sans-serif';
      ctx.fillStyle = '#666';
      ctx.fillText('Made with тЭдя╕П by Piyush Bharti', 540, 1310);

      // Helper: QR Code (Simplified - 11x11 blocks)
      function drawQRCode(ctx, x, y, size, url) {
        const blocks = 11;
        const blockSize = size / blocks;
        ctx.fillStyle = '#333';
        
        // Simple pattern (not real QR, but looks like one)
        for (let i = 0; i < blocks; i++) {
          for (let j = 0; j < blocks; j++) {
            // Corners
            if ((i < 3 && j < 3) || (i < 3 && j > 7) || (i > 7 && j < 3)) {
              if (!(i === 1 && j === 1) && !(i === 1 && j === blocks-2) && !(i === blocks-2 && j === 1)) {
                ctx.fillRect(x + i*blockSize, y + j*blockSize, blockSize, blockSize);
              }
            } 
            // Center pattern
            else if (i === 5 && j === 5) {
              ctx.fillRect(x + i*blockSize, y + j*blockSize, blockSize, blockSize);
            }
            // Random dots for realism
            else if (Math.random() > 0.6 && i > 2 && j > 2 && i < 8 && j < 8) {
              ctx.fillRect(x + i*blockSize, y + j*blockSize, blockSize, blockSize);
            }
          }
        }
        
        // URL below QR
        ctx.font = '32px Poppins, sans-serif';
        ctx.fillStyle = '#1976d2';
        ctx.textAlign = 'center';
        wrapText(ctx, getQuizUrl(), x + size/2, y + size + 40, size, 40);
      }

      // Text wrapping helper
      function wrapText(context, text, x, y, maxWidth, lineHeight) {
        const words = text.split(' ');
        let line = '';
        let yLine = y;
        for (let n = 0; n < words.length; n++) {
          const testLine = line + words[n] + ' ';
          const metrics = context.measureText(testLine);
          if (metrics.width > maxWidth && n > 0) {
            context.fillText(line, x, yLine);
            line = words[n] + ' ';
            yLine += lineHeight;
          } else {
            line = testLine;
          }
        }
        context.fillText(line, x, yLine);
      }

      // Convert & Share
      canvas.toBlob(async (blob) => {
        if (!blob) return;

        const quizUrl = getQuizUrl();
        const text = `ЁЯМЯ ${userName} рдиреЗ рд╕реНрд╡рдЪреНрдЫ рднрд╛рд░рдд рдХреНрд╡рд┐рдЬрд╝ рдореЗрдВ ${score}/20 рд╕реНрдХреЛрд░ рдХрд┐рдпрд╛!\n\n` +
                     `ЁЯПЖ рдмреИрдЬ: ${badgeTextElem.textContent}\n` +
                     `ЁЯФЧ рдЖрдк рднреА рджреАрдЬрд┐рдП рдпрд╣ рдЪреБрдиреМрддреА:\n${quizUrl}`;

        if (navigator.share && navigator.canShare) {
          try {
            await navigator.share({
              text: text,
              url: quizUrl,
              files: [
                new File([blob], `${userName.replace(/\s+/g, '_')}_swachh_score.png`, { type: "image/png" })
              ]
            });
            return;
          } catch (err) {
            if (err.name !== 'AbortError') console.log("Share failed:", err);
          }
        }

        // Fallback: WhatsApp
        const shareUrl = `https://wa.me/?text=${encodeURIComponent(text)}`;
        window.open(shareUrl, '_blank');
      }, 'image/png', 0.95);
    }

    // ... [рдмрд╛рдХреА рдлрдВрдХреНрд╢рдиреНрд╕ рд╡реИрд╕реЗ рд╣реА тАФ рдХреЗрд╡рд▓ рдПрдХ рдЫреЛрдЯрд╛ рдЕрдкрдбреЗрдЯ] ...
    function showResult() {
      // ... existing code ...
      badgeTextElem.textContent = badge;
      // Store for share function
      window.badgeTextElem = { textContent: badge };
    }
  </script>
</body>
</html>
